<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1, user-scalable=no">
  <meta name="description" content="API docs for the createInvoice method from the ProviderInvoices class, for the Dart programming language.">
  <title>createInvoice method - ProviderInvoices class - provider_invoices library - Dart API</title>


  
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,300;0,400;0,500;0,700;1,400&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" rel="stylesheet">
  
  <link rel="stylesheet" href="../../static-assets/github.css?v1">
  <link rel="stylesheet" href="../../static-assets/styles.css?v1">
  <link rel="icon" href="../../static-assets/favicon.png?v1">

  
</head>


<body data-base-href="../../" data-using-base-href="false" class="light-theme">

<div id="overlay-under-drawer"></div>

<header id="title">
  <span id="sidenav-left-toggle" class="material-symbols-outlined" role="button" tabindex="0">menu</span>
  <ol class="breadcrumbs gt-separated dark hidden-xs">
    <li><a href="../../index.html">easymoney</a></li>
    <li><a href="../../features_invoices_application_provider_invoices/features_invoices_application_provider_invoices-library.html">provider_invoices</a></li>
    <li><a href="../../features_invoices_application_provider_invoices/ProviderInvoices-class.html">ProviderInvoices</a></li>
    <li class="self-crumb">createInvoice method</li>
  </ol>
  <div class="self-name">createInvoice</div>
  <form class="search navbar-right" role="search">
    <input type="text" id="search-box" autocomplete="off" disabled class="form-control typeahead" placeholder="Loading search...">
  </form>
  <div class="toggle" id="theme-button">
    <label for="theme">
      <input type="checkbox" id="theme" value="light-theme">
      <span id="dark-theme-button" class="material-symbols-outlined">
        brightness_4
      </span>
      <span id="light-theme-button" class="material-symbols-outlined">
        brightness_5
      </span>
    </label>
  </div>
</header>
<main>

  <div
      id="dartdoc-main-content"
      class="main-content"
      data-above-sidebar="features_invoices_application_provider_invoices&#47;ProviderInvoices-class-sidebar.html"
      data-below-sidebar="">
      <div>
<h1><span class="kind-method">createInvoice</span> method 
</h1></div>

    <section class="multi-line-signature">
      

<span class="returntype"><a href="https://api.flutter.dev/flutter/dart-async/Future-class.html">Future</a><span class="signature">&lt;<wbr><span class="type-parameter">void</span>&gt;</span></span>
<span class="name ">createInvoice</span>(<wbr><ol class="parameter-list"><li><span class="parameter" id="createInvoice-param-profile">{<span>required</span> <span class="type-annotation"><a href="../../features_profile_domain_profile/Profile-class.html">Profile</a></span> <span class="parameter-name">profile</span>, </span></li>
<li><span class="parameter" id="createInvoice-param-receipts"><span>required</span> <span class="type-annotation"><a href="https://api.flutter.dev/flutter/dart-core/List-class.html">List</a><span class="signature">&lt;<wbr><span class="type-parameter"><a href="../../features_receipts_domain_receipt/Receipt-class.html">Receipt</a></span>&gt;</span></span> <span class="parameter-name">receipts</span>, </span></li>
<li><span class="parameter" id="createInvoice-param-files"><span>required</span> <span class="type-annotation"><a href="https://api.flutter.dev/flutter/dart-core/List-class.html">List</a><span class="signature">&lt;<wbr><span class="type-parameter"><a href="https://api.flutter.dev/flutter/dart-io/File-class.html">File</a></span>&gt;</span></span> <span class="parameter-name">files</span>}</span></li>
</ol>)

      

    </section>
    
<section class="desc markdown">
  <p>Composes a pdf invoice from receipts</p>
<p>Requires <code>profile</code> to whom the invoice is created,
list of the <code>receipts</code> to be used and list of <code>files</code> which
are the pictures of the receipts.</p>
</section>


    
<section class="summary source-code" id="source">
  <h2><span>Implementation</span></h2>
  <pre class="language-dart"><code class="language-dart">Future&lt;void&gt; createInvoice({
  required Profile profile,
  required List&lt;Receipt&gt; receipts,
  required List&lt;File&gt; files,
}) async {
  final receiptAndFileList = &lt;Map&lt;String, dynamic&gt;&gt;[];
  for (var receipt in receipts) {
    final receiptMap = {
      &#39;receipt&#39;: receipt,
      &#39;file&#39;: files.firstWhere((e) =&gt; e.path.contains(receipt.fileName))
    };
    receiptAndFileList.add(receiptMap);
  }
  final pdf = pw.Document();
  final thinData = await rootBundle.load(&#39;assets&#47;fonts&#47;Roboto-Thin.ttf&#39;);
  final thinStyle = pw.TextStyle(font: pw.Font.ttf(thinData));
  final regularData =
      await rootBundle.load(&#39;assets&#47;fonts&#47;Roboto-Regular.ttf&#39;);
  final regularStyle = pw.TextStyle(font: pw.Font.ttf(regularData));
  final boldData = await rootBundle.load(&#39;assets&#47;fonts&#47;Roboto-Bold.ttf&#39;);
  final boldStyle = pw.TextStyle(font: pw.Font.ttf(boldData));
  final date = DateTime.now();
  final dateOnly = &#39;${date.day}.${date.month}.${date.year}&#39;;
  final receiptWidgets = &lt;pw.Widget&gt;[];

  int endSum = 0;
  for (var receiptMap in receiptAndFileList) {
    final Receipt receipt = receiptMap[&#39;receipt&#39;];
    endSum += receipt.amount;
    receiptWidgets.add(
      pw.Flexible(
        child: pw.Row(
          mainAxisAlignment: pw.MainAxisAlignment.spaceBetween,
          crossAxisAlignment: pw.CrossAxisAlignment.start,
          children: [
            pw.Column(
              mainAxisAlignment: pw.MainAxisAlignment.start,
              mainAxisSize: pw.MainAxisSize.min,
              crossAxisAlignment: pw.CrossAxisAlignment.start,
              children: [
                pw.Text(
                  &#39;${receipt.dateOnly}, ${receipt.store}&#39;,
                  style: regularStyle,
                ),
                pw.SizedBox(
                  width: 400,
                  child: pw.Text(
                    receipt.description,
                    softWrap: true,
                    style: thinStyle,
                  ),
                ),
              ],
            ),
            pw.Text(&#39;${receipt.euros}€&#39;, style: regularStyle),
          ],
        ),
      ),
    );
    receiptWidgets.add(pw.Divider());
  }
  var fileName = &#39;${dateOnly}_${replaceNordics(text: profile.target)}&#39;;
  var fileCount = 0;
  var fileEnding = &#39;&#39;;
  while (
      await _invoicesRepository.isFileNameTaken(&#39;$fileName$fileEnding.pdf&#39;)) {
    fileCount++;
    fileEnding = &#39;_$fileCount&#39;;
  }
  fileName = &#39;$fileName$fileEnding.pdf&#39;;

  final invoice = Invoice(
    id: DateTime.now().millisecondsSinceEpoch,
    profileId: profile.id,
    date: date,
    target: profile.target,
    name: &#39;${profile.firstName} ${profile.lastName}&#39;,
    amount: endSum,
    fileName: fileName,
  );
  pdf.addPage(
    pw.MultiPage(
        maxPages: 30,
        pageFormat: PdfPageFormat.a4,
        build: (pw.Context context) {
          return [
            pw.SizedBox(
              width: double.infinity,
              child: pw.Padding(
                padding: const pw.EdgeInsets.only(bottom: 20),
                child: pw.Text(
                  &#39;Kululasku ${profile.target}, &#39;
                  &#39;$dateOnly,\n&#39;
                  &#39;${profile.firstName} ${profile.lastName}&#39;,
                  style: boldStyle.copyWith(
                    fontSize: 20,
                  ),
                  textAlign: pw.TextAlign.center,
                ),
              ),
            ),
            &#47;&#47;pw.Expanded(
            &#47;&#47;child:
            pw.Wrap(
              &#47;&#47;mainAxisAlignment: pw.MainAxisAlignment.start,
              &#47;&#47;mainAxisSize: pw.MainAxisSize.min,
              children: receiptWidgets,
            ),
            &#47;&#47;),
            pw.Row(
              mainAxisAlignment: pw.MainAxisAlignment.spaceBetween,
              children: [
                pw.Text(&#39;Yhteensä:&#39;, style: boldStyle),
                pw.Text(&#39;${(endSum &#47; 100).toStringAsFixed(2)}€&#39;,
                    style: boldStyle),
              ],
            ),
            pw.SizedBox(height: 20),
            pw.Align(
              alignment: pw.Alignment.centerLeft,
              child: pw.Text(&#39;Saaja:&#39;, style: boldStyle),
            ),
            pw.Align(
              alignment: pw.Alignment.centerLeft,
              child: pw.Text(
                &#39;${profile.firstName} ${profile.lastName}&#39;,
                style: boldStyle,
              ),
            ),
            pw.Align(
              alignment: pw.Alignment.centerLeft,
              child: pw.Text(profile.iban, style: boldStyle),
            ),
          ];
        }),
  );
  for (var receiptMap in receiptAndFileList) {
    File file = receiptMap[&#39;file&#39;];
    Receipt receipt = receiptMap[&#39;receipt&#39;];
    pdf.addPage(
      pw.Page(
        build: (pw.Context context) {
          return pw.Column(
            children: [
              pw.Text(
                &#39;${receipt.store}, ${receipt.dateOnly}&#39;,
                style: boldStyle.copyWith(fontSize: 20),
              ),
              pw.Image(
                pw.MemoryImage(file.readAsBytesSync()),
              ),
            ],
          );
        },
      ),
    );
  }
  await _invoicesRepository.saveInvoice(invoice: invoice, doc: pdf);
  notifyListeners();
}</code></pre>
</section>


  </div> <!-- /.main-content -->

  <div id="dartdoc-sidebar-left" class="sidebar sidebar-offcanvas-left">
    <!-- The search input and breadcrumbs below are only responsively visible at low resolutions. -->
<header id="header-search-sidebar" class="hidden-l">
  <form class="search-sidebar" role="search">
    <input type="text" id="search-sidebar" autocomplete="off" disabled class="form-control typeahead" placeholder="Loading search...">
  </form>
</header>

<ol class="breadcrumbs gt-separated dark hidden-l" id="sidebar-nav">
    <li><a href="../../index.html">easymoney</a></li>
    <li><a href="../../features_invoices_application_provider_invoices/features_invoices_application_provider_invoices-library.html">provider_invoices</a></li>
    <li><a href="../../features_invoices_application_provider_invoices/ProviderInvoices-class.html">ProviderInvoices</a></li>
    <li class="self-crumb">createInvoice method</li>
</ol>


    <h5>ProviderInvoices class</h5>
  </div><!--/.sidebar-offcanvas-->

  <div id="dartdoc-sidebar-right" class="sidebar sidebar-offcanvas-right">
  </div><!--/.sidebar-offcanvas-->

</main>

<footer>
  <span class="no-break">
    easymoney
      0.9.0
  </span>

  
</footer>



<script src="../../static-assets/highlight.pack.js?v1"></script>
<script src="../../static-assets/docs.dart.js"></script>



</body>

</html>

